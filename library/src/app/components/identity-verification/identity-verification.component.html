<!-- Demo Controls -->
<ng-container *ngIf="(isRecoverable$ | async) !== false">
  <ng-container *ngIf="configService.getConfig$() | async as config">
    <ng-container [formGroup]="identityDataResponseForm">
      <mat-form-field appearance="outline">
        <mat-label>GET /api/customer</mat-label>
        <mat-select formControlName="customerData">
          <mat-option
            *ngFor="let response of customerDataResponseList"
            [value]="response"
          >
            {{ response }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </ng-container>

    <mat-divider style="margin: 1rem 0"></mat-divider>

    <!-- Component -->
    <mat-card-title>
      <app-cybrid-logo
        fill="{{ config.theme === 'LIGHT' ? '#3f51b5' : 'white' }}"
      ></app-cybrid-logo>
    </mat-card-title>
    <mat-card-content>
      <ng-container *ngIf="timeout$ | async; else content">
        <div class="verification-content">
          <div>
            <mat-icon color="warn">cancel</mat-icon>
            <strong>{{
              'identityVerification.unexpectedError' | translate
            }}</strong>
          </div>
        </div>
      </ng-container>
      <ng-template #content>
        <ng-container *ngIf="isLoading$ | async">
          <div class="verification-content">
            <div>
              <app-loading [diameter]="16"></app-loading>
              <strong>{{
                stepper.selectedIndex === 0
                  ? ('identityVerification.checkStatus' | translate)
                  : ('identityVerification.verifying' | translate)
              }}</strong>
            </div>
          </div>
        </ng-container>
        <mat-stepper #stepper linear="true" animationDuration="0">
          <mat-step>
            <ng-container *ngIf="(customer$ | async)?.kyc_state as state">
              <ng-container [ngSwitch]="state">
                <ng-container *ngSwitchCase="'approved'">
                  <div class="verification-content">
                    <div>
                      <mat-icon color="primary">check_circle</mat-icon>
                      <strong>{{
                        'identityVerification.approved' | translate
                      }}</strong>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="'denied'">
                  <div class="verification-content">
                    <div>
                      <mat-icon color="warn">cancel</mat-icon>
                      <strong>{{
                        'identityVerification.denied' | translate
                      }}</strong>
                    </div>
                    <p>{{ 'identityVerification.support' | translate }}</p>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="'required'">
                  <div class="verification-content">
                    <div>
                      <mat-icon color="primary">arrow_circle_right</mat-icon>
                      <strong>{{
                        'identityVerification.required' | translate
                      }}</strong>
                    </div>
                  </div>
                </ng-container>
              </ng-container>
              <div class="verification-actions">
                <button
                  mat-stroked-button
                  [disabled]="state === 'approved' || state === 'denied'"
                >
                  {{ 'cancel' | translate }}
                </button>
                <button
                  *ngIf="state === 'required'; else done"
                  mat-flat-button
                  color="primary"
                  matStepperNext
                  (click)="verifyIdentity()"
                >
                  {{ 'begin' | translate }}
                </button>
                <ng-template #done>
                  <button mat-flat-button color="primary">
                    {{ 'done' | translate }}
                  </button>
                </ng-template>
              </div>
            </ng-container>
          </mat-step>
          <mat-step>
            <ng-container *ngIf="identity$ | async as identity">
              <ng-container [ngSwitch]="identity.outcome">
                <ng-container *ngSwitchCase="'passed'">
                  <div class="verification-content">
                    <div>
                      <mat-icon color="primary">check_circle</mat-icon>
                      <strong>{{
                        'identityVerification.approved' | translate
                      }}</strong>
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngSwitchCase="'failed'">
                  <div class="verification-content">
                    <div>
                      <mat-icon color="warn">cancel</mat-icon>
                      <strong>{{
                        'identityVerification.denied' | translate
                      }}</strong>
                    </div>
                    <p *ngFor="let reason of identity.failure_codes">
                      {{ reason }}
                    </p>
                  </div>
                </ng-container>
                <ng-container *ngSwitchDefault>
                  <ng-container *ngIf="identity.persona_state === 'reviewing'">
                    <div class="verification-content">
                      <div>
                        <mat-icon color="primary">help</mat-icon>
                        <strong>{{
                          'identityVerification.reviewing' | translate
                        }}</strong>
                      </div>
                      <p>{{ 'identityVerification.support' | translate }}</p>
                    </div>
                  </ng-container>
                </ng-container>
              </ng-container>
              <div class="verification-actions">
                <button mat-stroked-button>{{ 'cancel' | translate }}</button>
                <button
                  mat-flat-button
                  color="primary"
                  disabled="{{ isLoading$ | async }}"
                >
                  {{ 'done' | translate }}
                </button>
              </div>
            </ng-container>
          </mat-step>
          <mat-step>
            <div class="verification-content">
              <div>
                <mat-icon color="primary">play_circle</mat-icon>
                <strong>Resume identity verification.</strong>
              </div>
            </div>
            <div class="verification-actions">
              <button mat-stroked-button>{{ 'cancel' | translate }}</button>
              <button
                mat-flat-button
                color="primary"
                matStepperNext
                (click)="verifyIdentity(); stepper.previous()"
              >
                RESUME
              </button>
            </div>
          </mat-step>
        </mat-stepper>
      </ng-template>
    </mat-card-content>
  </ng-container>
</ng-container>
