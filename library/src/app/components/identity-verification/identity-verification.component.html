<ng-container *ngIf="(isRecoverable$ | async) !== false">
  <ng-container *ngIf="configService.getConfig$() | async as config">
    <mat-card-title>
      <app-cybrid-logo
        [ngClass]="
          config.theme === 'LIGHT' ? 'cybrid-logo-light' : 'cybrid-logo-dark'
        "
      ></app-cybrid-logo>
    </mat-card-title>
    <mat-card-content>
      <!-- Error -->
      <ng-container *ngIf="error$ | async; else content">
        <div class="verification-content">
          <div>
            <mat-icon color="warn">cancel</mat-icon>
            <strong>{{ 'unexpectedError' | translate }}</strong>
          </div>
        </div>
      </ng-container>

      <!-- Content -->
      <ng-template #content>
        <ng-container *ngIf="isLoading$ | async">
          <div class="verification-content">
            <div>
              <app-loading [diameter]="16"></app-loading>
              <strong>{{
                stepper.selectedIndex === 0
                  ? ('identityVerification.checkStatus' | translate)
                  : ('identityVerification.verifying' | translate)
              }}</strong>
            </div>
          </div>
        </ng-container>
        <mat-stepper #stepper linear="true" animationDuration="0">
          <!-- Customer Step -->
          <mat-step>
            <ng-container *ngIf="customer$ | async as customer">
              <app-customer-content
                [customer]="customer"
              ></app-customer-content>
              <div class="cybrid-actions">
                <button
                  id="cancel"
                  mat-stroked-button
                  [disabled]="
                    customer.state === 'verified' ||
                    customer.state === 'rejected'
                  "
                  (click)="onCancel()"
                >
                  {{ 'cancel' | translate }}
                </button>
                <button
                  *ngIf="customer.state === 'unverified'; else done"
                  id="verify"
                  mat-flat-button
                  color="primary"
                  matStepperNext
                  (click)="verifyIdentity()"
                >
                  {{ 'begin' | translate }}
                </button>
                <ng-template #done>
                  <button
                    id="customer-button-done"
                    mat-flat-button
                    color="primary"
                    (click)="onComplete()"
                  >
                    {{ 'done' | translate }}
                  </button>
                </ng-template>
              </div>
            </ng-container>
          </mat-step>

          <!-- Identity Step -->
          <mat-step>
            <ng-container *ngIf="identity$ | async as identity">
              <app-identity-content
                [identity]="identity"
              ></app-identity-content>
              <div class="cybrid-actions">
                <button
                  id="identity-button-done"
                  mat-flat-button
                  color="primary"
                  disabled="{{ isLoading$ | async }}"
                  (click)="onComplete()"
                >
                  {{ 'done' | translate }}
                </button>
              </div>
            </ng-container>
          </mat-step>

          <!-- Resume step -->
          <mat-step>
            <div class="verification-content">
              <div>
                <mat-icon color="primary">play_circle</mat-icon>
                <strong>{{ 'identityVerification.resume' | translate }}</strong>
              </div>
            </div>
            <div class="cybrid-actions">
              <button mat-stroked-button (click)="onCancel()">
                {{ 'cancel' | translate }}
              </button>
              <button
                mat-flat-button
                color="primary"
                matStepperNext
                (click)="verifyIdentity(); stepper.previous()"
              >
                {{ 'resume' | translate }}
              </button>
            </div>
          </mat-step>
        </mat-stepper>
      </ng-template>
    </mat-card-content>
  </ng-container>
</ng-container>
